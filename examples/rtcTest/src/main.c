/**
 ****************************************************************************************
 *
 * @file main.c
 *
 * @brief 应用程序主入口
 *
 * @details
 * 程序执行主流程：
 * 系统初始化 → 设备初始化 → RTC测试
 *
 ****************************************************************************************
 */

#include "b6x.h"
#include "drvs.h"
#include "dbg.h"


/*
 * DEFINES
 ****************************************************************************************
 */



/*
 * FUNCTIONS
 ****************************************************************************************
 */

/**
 ****************************************************************************************
 * @brief 系统初始化函数
 *
 * @details
 * 配置系统基础设置
 ****************************************************************************************
 */
static void sysInit(void)
{
    // Todo config, if need - 可在此添加系统时钟等配置
}

/**
 ****************************************************************************************
 * @brief 设备初始化函数
 *
 * @details
 * 初始化外设模块：
 * - 读取复位原因
 * - 禁用看门狗
 * - 初始化调试接口
 * - 输出启动信息
 ****************************************************************************************
 */
static void devInit(void)
{  
    uint16_t rsn = rstrsn();  ///< 读取复位原因寄存器
    
    iwdt_disable();  ///< 禁用独立看门狗
    
    dbgInit();                    ///< 初始化调试接口
    debug("Start(rsn:0x%X)...\\r\\n", rsn);  ///< 输出启动信息和复位原因
}

extern void rtcTest(void);  ///< 声明RTC测试函数

/**
 ****************************************************************************************
 * @brief 主函数
 *
 * @return int 程序退出状态
 *
 * @details
 * 程序执行主流程：
 * 系统初始化 → 设备初始化 → RTC测试
 ****************************************************************************************
 */
int main(void)
{
    sysInit();    ///< 系统初始化
    devInit();    ///< 设备初始化
    
    rtcTest();    ///< 执行RTC测试
}
